"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=require("wonka"),t=require("graphql"),n=e(require("fast-json-stable-stringify")),o=e(require("graphql-tag")),i=require("react");function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var u=function(e,r){var t="";return void 0!==e?t="[Network] "+e.message:(void 0!==r&&r.forEach(function(e){t+="[GraphQL] "+e.message+"\n"}),t.trim())},c=function(e){return"string"==typeof e?new t.GraphQLError(e):"object"==typeof e&&e.message?new t.GraphQLError(e.message,e.nodes,e.source,e.positions,e.path,e.originalError,e.extensions||{}):e};function s(){return this.message}var p=function(e){function r(r){var t=r.networkError,n=r.response,o=(r.graphQLErrors||[]).map(c),i=u(t,o);e.call(this,i),this.name="CombinedError",this.message=i,this.graphQLErrors=o,this.networkError=t,this.response=n}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=s,r}(Error),f=function(e){for(var r=5381,t=0,n=0|e.length;t<n;t++)r=(r<<5)+r+e.charCodeAt(t);return r>>>0},d=Object.create(null);function v(e,r){return e+(void 0!==r.name?r.name.value:"")}var l=function(e,r){var o=function(e){if(void 0!==e.__key)return e.__key;var r=e.definitions.reduce(v,"");if("production"!==process.env.NODE_ENV&&""!==r){var n=t.print(e);r in d?d[r]!==n&&console.warn("Warning: Encountered multiple DocumentNodes with the same name."):d[r]=n}""===r&&(r=t.print(e));var o=f(r);return e.__key=o,o}(e);return null==r?o:f(""+o+n(r))},h=function(e,r){var t="string"==typeof e?o([e]):e;return{key:l(t,r),query:t,variables:r||{}}},y=function(e,r){return a({},e,{context:a({},e.context,{meta:a({},e.context.meta,r)})})},m="undefined"==typeof window||!("HTMLElement"in window),g=function(e,r){if(void 0===r&&(r=[]),Array.isArray(e))e.forEach(function(e){return g(e,r)});else if("object"==typeof e&&null!==e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=e[t];"__typename"===t&&"string"==typeof n?r.push(n):"object"==typeof n&&null!==n&&g(n,r)}return r};function x(e,r,t){return t.indexOf(e)===r}var b=function(e){return g(e).filter(x)};function O(e){return"Field"===e.kind&&"__typename"===e.name.value}var w=function(e){return void 0!==e.selectionSet&&(e.selectionSet.selections.some(O)?e:a({},e,{selectionSet:a({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:"Field",name:{kind:"Name",value:"__typename"}}])})}))},E=function(e){return t.visit(e,{Field:w,InlineFragment:w,OperationDefinition:w})},k=function(){},q=function(e){var r=e.operationName;return"subscription"!==r&&"query"!==r};function _(e){return""+e}var S=function(e){var r=e.error,t={data:e.data,error:void 0};return void 0!==r&&(t.error={networkError:""+r.networkError,graphQLErrors:r.graphQLErrors.map(_)}),t},N=function(e,r){var t=r.error,n={operation:e,data:r.data,error:void 0};return void 0!==t&&(n.error=new p({networkError:new Error(t.networkError),graphQLErrors:t.graphQLErrors})),n},C=function(e){var r=e.operationName;return"mutation"!==r&&"query"!==r};function R(e){return a({},e,{query:E(e.query)})}function M(e){return C(e)}function P(e){return y(e,{cacheOutcome:"miss"})}var j=function(e){var t=e.forward,n=e.client,o=new Map,i=Object.create(null),u=R,c=Q(o,i,n),s=D(o,i),p=function(e){var r=e.context.requestPolicy;return"query"===e.operationName&&"network-only"!==r&&("cache-only"===r||o.has(e.key))};function f(e){return!C(e)&&p(e)}function d(e){var r=e.context,t=o.get(e.key);return"cache-and-network"===r.requestPolicy&&L(n,e),void 0!==t?a({},t,{operation:y(t.operation,{cacheOutcome:"hit"})}):{data:void 0,error:void 0,operation:y(e,{cacheOutcome:"miss"})}}function v(e){return!C(e)&&!p(e)}function l(e){e.operation&&"mutation"===e.operation.operationName?c(e):e.operation&&"query"===e.operation.operationName&&s(e)}return function(e){var n=r.share(e),o=r.pipe(n,r.filter(f),r.map(d)),i=r.pipe(r.merge([r.pipe(n,r.filter(v),r.map(u)),r.pipe(n,r.filter(M))]),r.map(P),t,r.tap(l));return r.merge([o,i])}},L=function(e,r){return e.reexecuteOperation(a({},r,{context:a({},r.context,{requestPolicy:"network-only"})}))},Q=function(e,r,t){function n(r){if(e.has(r)){var n=e.get(r).operation;e.delete(r),L(t,n)}}return function(e){var t=new Set;function o(e){return t.add(e)}b(e.data).forEach(function(e){var t=r[e]||(r[e]=new Set);t.forEach(o),t.clear()}),t.forEach(n)}},D=function(e,r){return function(t){var n=t.operation;void 0!==t.data&&(e.set(n.key,t),b(t.data).forEach(function(e){(r[e]||(r[e]=new Set)).add(n.key)}))}},A=function(e){return"subscription"===e.operationName};function U(e){return!A(e)}function I(e){return console.log("[Exchange debug]: Incoming operation: ",e)}function T(e){return console.log("[Exchange debug]: Completed operation: ",e)}var W=function(e){var t=e.forward,n=new Set,o=function(e){var r=e.key,t=e.operationName;if("teardown"===t)return n.delete(r),!0;if("query"!==t)return!0;var o=n.has(r);return n.add(r),!o},i=function(e){n.delete(e.operation.key)};return function(e){var n=r.pipe(e,r.filter(o));return r.pipe(t(n),r.tap(i))}};function F(e){var r=e.operationName;return"query"===r||"mutation"===r}var $=function(e){var t=e.forward,n=F;function o(e){return!n(e)}return function(e){var i=r.share(e),a=r.pipe(i,r.filter(n),r.mergeMap(function(e){var t=e.key,n=r.pipe(i,r.filter(function(e){return"teardown"===e.operationName&&e.key===t}));return r.pipe(G(e),r.takeUntil(n))})),u=r.pipe(i,r.filter(o),t);return r.merge([a,u])}},G=function(e){if("subscription"===e.operationName)throw new Error("Received a subscription operation in the httpExchange. You are probably trying to create a subscription. Have you added a subscriptionExchange?");return r.make(function(r){var n=r[0],o=r[1],i="undefined"!=typeof AbortController?new AbortController:void 0,u=e.context,c="function"==typeof u.fetchOptions?u.fetchOptions():u.fetchOptions||{},s=a({body:JSON.stringify({query:t.print(e.query),variables:e.variables}),method:"POST"},c,{headers:a({"content-type":"application/json"},c.headers),signal:void 0!==i?i.signal:void 0}),p=Date.now();return V(e,s).then(function(e){void 0!==e&&n(a({},e,{operation:y(e.operation,{networkLatency:Date.now()-p})})),o()}),function(){void 0!==i&&i.abort()}})},V=function(e,r){var t;return fetch(e.context.url,r).then(function(e){return H(r.redirect,t=e),t.json()}).then(function(r){return{operation:e,data:r.data,error:Array.isArray(r.errors)?new p({graphQLErrors:r.errors,response:t}):void 0}}).catch(function(r){if("AbortError"!==r.name)return{operation:e,data:void 0,error:new p({networkError:r,response:t})}})},H=function(e,r){if(void 0===e&&(e="follow"),r.status<200||r.status>=("manual"===e?400:300))throw new Error(r.statusText)};function Y(e){var r=e.operationName;"teardown"!==r&&"production"!==process.env.NODE_ENV&&console.warn('No exchange has handled operations of type "'+r+"\". Check whether you've added an exchange responsible for these operations.")}function B(){return!1}var J=function(e){return r.pipe(e,r.tap(Y),r.filter(B))},z=function(e){return 1===e.length?e[0]:function(r){var t=r.client;return e.reduceRight(function(e,r){return r({client:t,forward:e})},r.forward)}},K=[W,j,$],X=function(e){return new Z(e)},Z=function(e){var t=this;this.activeOperations=Object.create(null),this.createOperationContext=function(e){var r=(e||{}).requestPolicy;return void 0===r&&(r="cache-first"),a({url:t.url,fetchOptions:t.fetchOptions},e,{requestPolicy:r})},this.createRequestOperation=function(e,r,n){return{key:r.key,query:r.query,variables:r.variables,operationName:e,context:t.createOperationContext(n)}},this.reexecuteOperation=function(e){(t.activeOperations[e.key]||0)>0&&t.dispatchOperation(e)},this.executeQuery=function(e,r){var n=t.createRequestOperation("query",e,r);return t.executeRequestOperation(n)},this.executeSubscription=function(e,r){var n=t.createRequestOperation("subscription",e,r);return t.executeRequestOperation(n)},this.executeMutation=function(e,r){var n=t.createRequestOperation("mutation",e,r);return t.executeRequestOperation(n)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.suspense=!!e.suspense;var n=r.makeSubject(),o=n[1];this.operations$=n[0],this.dispatchOperation=o,this.exchange=z(void 0!==e.exchanges?e.exchanges:K),this.results$=r.share(this.exchange({client:this,forward:J})(this.operations$))};Z.prototype.onOperationStart=function(e){var r=e.key;this.activeOperations[r]=(this.activeOperations[r]||0)+1,this.dispatchOperation(e)},Z.prototype.onOperationEnd=function(e){var r=e.key,t=this.activeOperations[r]||0;(this.activeOperations[r]=t<=0?0:t-1)<=0&&this.dispatchOperation(a({},e,{operationName:"teardown"}))},Z.prototype.executeRequestOperation=function(e){var t=this,n=e.key,o=e.operationName,i=r.pipe(this.results$,r.filter(function(e){return e.operation.key===n}));if("mutation"===o)return r.pipe(i,r.onStart(function(){return t.dispatchOperation(e)}),r.take(1));var a,u=r.pipe(i,r.onStart(function(){return t.onOperationStart(e)}),r.onEnd(function(){return t.onOperationEnd(e)}));return this.suspense?(a=u,r.make(function(e){var t,n,o=e[1],i=!1,u=r.pipe(a,r.onPush(e[0]),r.onEnd(o),r.subscribe(function(e){void 0===t?n=e:i||(t(e),o(),u())}))[0];if(void 0===n)throw new Promise(function(e){t=e});return function(){i=!0,u()}})):u};var ee=X({url:"/graphql"}),re=i.createContext(ee),te=re.Provider,ne=re.Consumer,oe=function(e){var r=i.useRef(!1),t=i.useRef(a({},e)),n=i.useState(t.current),o=n[0],u=n[1],c=i.useCallback(function(e){if(r.current)u(e);else{var n="function"==typeof e?e(t.current):e;a(t.current,n)}},[]);function s(){r.current=!1}return!m&&i.useLayoutEffect(function(){return r.current=!0,s},[]),[o,c]},ie=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ae=function(e){return e&&(0===e.tag||1===e.tag||2===e.tag)},ue=function(e){return"Query"===e.name||"Mutation"===e.name||"Subscription"===e.name};function ce(){var e="Component",r=ie.current;if(null!==r&&ae(r)){var t=r.type;ue(t)&&ae(r._debugOwner)&&(t=r._debugOwner.type),"function"==typeof t&&(e=t.displayName||t.name||e)}return{meta:{source:e}}}var se,pe="production"!==process.env.NODE_ENV&&ie?function(){return i.useMemo(ce,[])}:function(){},fe=function(e){var t=pe(),n=i.useContext(re),o=oe({fetching:!1,error:void 0,data:void 0}),a=o[1];function u(e){return a({fetching:!1,data:e.data,error:e.error}),e}return[o[0],i.useCallback(function(o){a({fetching:!0,error:void 0,data:void 0});var i=h(e,o);return r.pipe(n.executeMutation(i,t),r.toPromise).then(u)},[n,t,e,a])]},de=function(e,r){var t=i.useRef(void 0);return i.useMemo(function(){var n=h(e,r);return void 0!==t.current&&t.current.key===n.key?t.current:(t.current=n,n)},[e,r])};function ve(e){return a({},e,{fetching:!0})}function le(e){return a({},e,{fetching:!1})}!function(e){e[e.WillMount=0]="WillMount",e[e.DidMount=1]="DidMount",e[e.Update=2]="Update"}(se||(se={}));var he=function(e){var t=pe(),n=i.useRef(k),o=i.useContext(re),u=oe({fetching:!1,data:void 0,error:void 0}),c=u[0],s=u[1],p=de(e.query,e.variables);function f(e){s({fetching:!1,data:e.data,error:e.error})}var d=i.useCallback(function(i){var u;n.current(),s(ve),u=r.pipe(o.executeQuery(p,a({requestPolicy:e.requestPolicy},i,t)),r.subscribe(f)),n.current=u[0]},[e.requestPolicy,o,t,p,s]);function v(){return n.current()}return function(e,r){var t=i.useRef(void 0),n=i.useRef(se.WillMount);n.current===se.WillMount&&(n.current=se.DidMount,t.current=e()),i.useEffect(function(){return n.current===se.Update?t.current=e():(n.current=se.Update,t.current)},r)}(function(){return e.pause?(n.current(),s(le),k):(d(),v)},[d,e.pause,s]),[c,d]},ye=function(e,t){var n=pe(),o=i.useRef(k),a=i.useContext(re),u=oe({fetching:!0,error:void 0,data:void 0}),c=u[0],s=u[1],p=de(e.query,e.variables);function f(e){var r=e.data,n=e.error;s(function(e){return{fetching:!0,data:void 0!==t?t(e.data,r):r,error:n}})}var d=i.useCallback(function(){var e;o.current(),e=r.pipe(a.executeSubscription(p,n),r.subscribe(f)),o.current=e[0]},[a,n,t,p,s]);function v(){return o.current()}return i.useEffect(function(){return d(),v},[d]),[c]};function me(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&(t[n[o]]=e[n[o]])}return t}exports.Client=Z,exports.CombinedError=p,exports.Consumer=ne,exports.Context=re,exports.Mutation=function(e){var r=e.children,t=fe(e.query);return r(a({},t[0],{executeMutation:t[1]}))},exports.Provider=te,exports.Query=function(e){var r=e.children,t=me(e,["children"]),n=he(t);return r(a({},n[0],{executeQuery:n[1]}))},exports.Subscription=function(e){var r=e.children,t=e.handler,n=me(e,["children","handler"]);return r(ye(n,t)[0])},exports.cacheExchange=j,exports.composeExchanges=z,exports.createClient=X,exports.createRequest=h,exports.debugExchange=function(e){var t=e.forward;return function(e){return r.pipe(e,r.tap(I),t,r.tap(T))}},exports.dedupExchange=W,exports.defaultExchanges=K,exports.fallbackExchangeIO=J,exports.fetchExchange=$,exports.ssrExchange=function(e){var t={},n=function(e){return!q(e)&&void 0!==t[e.key]};function o(e){return!n(e)}function i(e){return n(e)}function u(e){return N(e,t[e.key])}function c(e){var r=e.operation;if(!q(r)){var n=S(e);t[r.key]=n}}function s(e){delete t[e.operation.key]}var p=function(e){var t=e.client,n=e.forward;return function(e){var a=r.share(e),p=r.pipe(a,r.filter(o),n),f=r.pipe(a,r.filter(i),r.map(u));return t.suspense?p=r.pipe(p,r.tap(c)):f=r.pipe(f,r.tap(s)),r.merge([p,f])}};return p.restoreData=function(e){return a(t,e)},p.extractData=function(){return a({},t)},e&&e.initialState&&p.restoreData(e.initialState),p},exports.subscriptionExchange=function(e){var n=e.forwardSubscription;function o(e){var o=n({key:e.key.toString(36),query:t.print(e.query),variables:e.variables,context:a({},e.context)});return r.make(function(r){var t=r[0],n=o.subscribe({next:function(r){return t({operation:e,data:r.data||void 0,error:Array.isArray(r.errors)?new p({graphQLErrors:r.errors,response:void 0}):void 0})},error:function(r){return t({operation:e,data:void 0,error:new p({networkError:r,response:void 0})})},complete:r[1]});return function(){return n.unsubscribe()}})}return function(e){var t=e.forward,n=o;return function(e){var o=r.share(e),i=r.pipe(o,r.filter(A),r.mergeMap(function(e){var t=e.key,i=r.pipe(o,r.filter(function(e){return"teardown"===e.operationName&&e.key===t}));return r.pipe(n(e),r.takeUntil(i))})),a=r.pipe(o,r.filter(U),t);return r.merge([i,a])}}},exports.useMutation=fe,exports.useQuery=he,exports.useSubscription=ye;
//# sourceMappingURL=urql.min.js.map
